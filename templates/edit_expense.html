{% extends "base.html" %}
{% block content %}
<style>
body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #0d47a1 0%, #f8bbd0 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: black; /* Default text color */
}

.edit-card {
    background: #fff;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    width: 450px;
    color: black; /* Card text color */
}

h2 {
    text-align: center;
    color: black; /* Heading text */
    margin-bottom: 25px;
}

label {
    font-weight: 600;
    color: black; /* Label text */
    display: block;
    margin-bottom: 5px;
}

input, select, textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    transition: 0.3s;
    color: black; /* Input text */
}

input:focus, select:focus, textarea:focus {
    border-color: #d81b60;
    box-shadow: 0 0 5px rgba(216,27,96,0.3);
    outline: none;
    color: black;
}

button {
    width: 100%;
    padding: 12px;
    background-color: navy;
    color: black; /* Button text black */
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background-color: #ffb6c1;
    color: black; /* Hover button text black */
}
</style>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="edit-card">
    <h2>‚úèÔ∏è Edit Expense ‚Äî Buzzard</h2>

   <form id="editExpenseForm" method="post" action="{{ url_for('edit_expense', expense_id=expense.id) }}">
    <div>
        <label>Title</label>
        <input type="text" name="title" value="{{ expense.title }}" required>
    </div>

    <div>
        <label>Category</label>
        <select name="category" required>
            {% for c in categories %}
                <option value="{{ c }}" {% if expense.category == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label>Amount (‚Ç±)</label>
        <input type="number" name="amount" step="0.01" value="{{ expense.amount }}" required>
    </div>

    <div>
        <label>Date</label>
        <input type="date" name="date" value="{{ expense.date }}" required>
    </div>

    <div>
        <label>Purpose / Remarks</label>
        <textarea name="purpose" rows="3">{{ expense.purpose }}</textarea>
    </div>

    <button type="submit">üíæ Save Changes</button>
</form>

</div>

<script>
document.getElementById("editExpenseForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.redirected) {
            Swal.fire({
                icon: 'success',
                title: 'Expense Updated!',
                text: 'The expense has been successfully updated.',
                showConfirmButton: false,
                timer: 1800,
                background: '#fff',
                color: 'black',  /* SweetAlert text color black */
                iconColor: '#d81b60'
            });
            setTimeout(() => {
                window.location.href = response.url;
            }, 1800);
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Update Failed',
                text: 'Something went wrong. Please try again.',
                confirmButtonColor: '#d81b60',
                color: 'black' /* SweetAlert text color black */
            });
        }
    })
    .catch(() => {
        Swal.fire({
            icon: 'error',
            title: 'Connection Error',
            text: 'Unable to update expense. Check your internet or server.',
            confirmButtonColor: '#d81b60',
            color: 'black' /* SweetAlert text color black */
        });
    });
});
</script>

{% endblock %}
